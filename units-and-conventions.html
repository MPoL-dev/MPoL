
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Units and Conventions &#8212; MPoL 0.1.13 documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script src="https://buttons.github.io/buttons.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://unpkg.com/mermaid@9.4.0/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Developer Documentation" href="developer-documentation.html" />
    <link rel="prev" title="MPoL Installation" href="installation.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">MPoL 0.1.13 documentation</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  User Guide
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="rml_intro.html">
   Introduction to Regularized Maximum Likelihood Imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="installation.html">
   MPoL Installation
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Units and Conventions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="developer-documentation.html">
   Developer Documentation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="api.html">
   API
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Tutorials
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="ci-tutorials/PyTorch.html">
   Introduction to PyTorch: Tensors and Gradient Descent
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ci-tutorials/gridder.html">
   Gridding and diagnostic images
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ci-tutorials/optimization.html">
   Intro to RML with MPoL
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ci-tutorials/loose-visibilities.html">
   Likelihood functions and model visibilities
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ci-tutorials/crossvalidation.html">
   Cross validation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ci-tutorials/gpu_setup.html">
   GPU Acceleration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ci-tutorials/initializedirtyimage.html">
   Initializing with the Dirty Image
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="large-tutorials/HD143006_part_1.html">
   HD143006 Tutorial Part 1
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="large-tutorials/HD143006_part_2.html">
   HD143006 Tutorial Part 2
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ci-tutorials/fakedata.html">
   Making a Mock Dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="large-tutorials/pyro.html">
   Parametric Inference with Pyro
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="changelog.html">
   Changelog
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>
<a href="https://github.com/MPoL-dev/MPoL"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="bottom"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/units-and-conventions.md.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#fourier-transform-conventions">
   Fourier transform conventions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#continuous-representation-of-interferometry">
   Continuous representation of interferometry
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#discretized-representation">
   Discretized representation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pixel-fluxes-and-cube-dimensions">
     Pixel fluxes and Cube dimensions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#angular-units">
     Angular units
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#fourier-units">
     Fourier units
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-discrete-fourier-transform">
     The discrete Fourier transform
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#image-cube-packing-for-ffts">
     Image Cube Packing for FFTs
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Units and Conventions</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#fourier-transform-conventions">
   Fourier transform conventions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#continuous-representation-of-interferometry">
   Continuous representation of interferometry
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#discretized-representation">
   Discretized representation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pixel-fluxes-and-cube-dimensions">
     Pixel fluxes and Cube dimensions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#angular-units">
     Angular units
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#fourier-units">
     Fourier units
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-discrete-fourier-transform">
     The discrete Fourier transform
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#image-cube-packing-for-ffts">
     Image Cube Packing for FFTs
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="units-and-conventions">
<span id="units-conventions-label"></span><h1>Units and Conventions<a class="headerlink" href="#units-and-conventions" title="Permalink to this headline">#</a></h1>
<section id="fourier-transform-conventions">
<h2>Fourier transform conventions<a class="headerlink" href="#fourier-transform-conventions" title="Permalink to this headline">#</a></h2>
<p>We follow the (reasonably standard) conventions of the Fourier transform (e.g., <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2000fta..book.....B/abstract">Bracewell’s</a> “system 1”).</p>
<p><strong>Forward transform</strong>:</p>
<div class="math notranslate nohighlight">
\[
F(s) = \int_{-\infty}^\infty f(x) e^{-i 2 \pi  x s} \mathrm{d}x
\]</div>
<p><strong>Inverse transform</strong>:</p>
<div class="math notranslate nohighlight">
\[
f(x) = \int_{-\infty}^\infty F(s) e^{i 2 \pi  x s} \mathrm{d}s
\]</div>
</section>
<section id="continuous-representation-of-interferometry">
<h2>Continuous representation of interferometry<a class="headerlink" href="#continuous-representation-of-interferometry" title="Permalink to this headline">#</a></h2>
<p>Consider some astronomical source parameterized by its sky brightness distribution <span class="math notranslate nohighlight">\(I\)</span>. The sky brightness is a function of position on the sky. For small fields of view (typical to single-pointing ALMA or VLA observations) we parameterize the sky direction using the direction cosines <span class="math notranslate nohighlight">\(l\)</span> and <span class="math notranslate nohighlight">\(m\)</span>, which correspond to R.A. and Dec, respectively. In that case, we would have a function <span class="math notranslate nohighlight">\(I(l,m)\)</span>. The sky brightness is an <em>intensity</em>, so it has units of <span class="math notranslate nohighlight">\(\mathrm{Jy\,arcsec}^{-2}\)</span> (equivalently <span class="math notranslate nohighlight">\(\mathrm{Jy\, beam}^{-1}\)</span>, where <span class="math notranslate nohighlight">\(\mathrm{beam}\)</span> is the effective area of the synthesized beam).</p>
<p>The real domain is linked to the Fourier domain, also called the visibility domain, via the Fourier transform</p>
<div class="math notranslate nohighlight">
\[
{\cal V}(u,v) = \int \int I(l,m) \exp \left \{- 2 \pi i (ul + vm) \right \} \, \mathrm{d}l\,\mathrm{d}m.
\]</div>
<p>This integral demonstrates that the units of visibility function (and samples of it) are <span class="math notranslate nohighlight">\(\mathrm{Jy}\)</span>.</p>
</section>
<section id="discretized-representation">
<h2>Discretized representation<a class="headerlink" href="#discretized-representation" title="Permalink to this headline">#</a></h2>
<p>There are several annoying pitfalls that can arise when dealing with discretized images and Fourier transforms, and most relate back to confusing or ill-specified conventions. The purpose of this page is to explicitly define the conventions used throughout MPoL and make clear how each transformation relates back to the continuous equations.</p>
<section id="pixel-fluxes-and-cube-dimensions">
<h3>Pixel fluxes and Cube dimensions<a class="headerlink" href="#pixel-fluxes-and-cube-dimensions" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>Throughout the codebase, any sky plane cube representing the sky plane is assumed to have units of <span class="math notranslate nohighlight">\(\mathrm{Jy\,arcsec}^{-2}\)</span>.</p></li>
<li><p>The image cubes are packed as 3D arrays <code class="docutils literal notranslate"><span class="pre">(nchan,</span> <span class="pre">npix,</span> <span class="pre">npix)</span></code>.</p></li>
<li><p>The “rows” of the image cube (axis=1) correspond to the <span class="math notranslate nohighlight">\(m\)</span> or Dec axis. There are <span class="math notranslate nohighlight">\(M\)</span> number of pixels in the Dec axis.</p></li>
<li><p>The “columns” of the image cube (axis=2) correspond to the <span class="math notranslate nohighlight">\(l\)</span> or R.A. axis. There are <span class="math notranslate nohighlight">\(L\)</span> number of pixels in the R.A. axis.</p></li>
</ul>
</section>
<section id="angular-units">
<h3>Angular units<a class="headerlink" href="#angular-units" title="Permalink to this headline">#</a></h3>
<p>For nearly all user-facing routines, the angular axes (the direction cosines <span class="math notranslate nohighlight">\(l\)</span> and <span class="math notranslate nohighlight">\(m\)</span> corresponding to R.A. and Dec, respectively) are expected to have units of arcseconds. The sample rate of the image cube is set via the <code class="docutils literal notranslate"><span class="pre">cell_size</span></code> parameter, in units of arcsec. Internally, these quantities are represented in radians.  Let the pixel spacing be represented by <span class="math notranslate nohighlight">\(\Delta l\)</span> and <span class="math notranslate nohighlight">\(\Delta m\)</span>, respectively.</p>
</section>
<section id="fourier-units">
<h3>Fourier units<a class="headerlink" href="#fourier-units" title="Permalink to this headline">#</a></h3>
<p>The sampling rate in the Fourier domain is inversely related to the number of samples and the sampling rate in the image domain. I.e., the grid spacing is</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\Delta u = \frac{1}{L \Delta l} \\
\Delta v = \frac{1}{M \Delta m}.
\end{split}\]</div>
<p>If <span class="math notranslate nohighlight">\(\Delta l\)</span> and <span class="math notranslate nohighlight">\(\Delta m\)</span> are in units of radians, then <span class="math notranslate nohighlight">\(\Delta u\)</span> and <span class="math notranslate nohighlight">\(\Delta v\)</span> are in units of cycles per radian. Thanks to the geometric relationship of the interferometer, the spatial frequency units can equivalently be expressed as the baseline lengths measured in multiples of the observing wavelength <span class="math notranslate nohighlight">\(\lambda\)</span>.</p>
<p>For example, take an observation with ALMA band 6 at an observing frequency of 230 GHz, corresponding to a wavelength of 1.3mm. A 100 meter baseline between antennas will measure a spatial frequency of <span class="math notranslate nohighlight">\(\frac{100\,\mathrm{m} }{ 1.3 \times 10^{-3}\,\mathrm{m}} \approx 77 \mathrm{k}\lambda\)</span> or 77,000 cycles per radian.</p>
<p>For more information on the relationship between baselines and spatial frequencies, see <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2017isra.book.....T/abstract">TMS Eqn Chapter 2.3, equations 2.13 and 2.14</a>. Internally, MPoL usually represents spatial frequencies in units of <span class="math notranslate nohighlight">\(\mathrm{k}\lambda\)</span>.</p>
<p>For reference, here are some typical ALMA baseline lengths and their (approximate) corresponding spatial frequencies at common observing frequencies</p>
<table class="table">
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>baseline</p></th>
<th class="head"><p>100 GHz (Band 3)</p></th>
<th class="head"><p>230 GHz (Band 6)</p></th>
<th class="head"><p>340 GHz (Band 7)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>10 m</p></td>
<td><p>3 <span class="math notranslate nohighlight">\(\mathrm{k}\lambda\)</span></p></td>
<td><p>8 <span class="math notranslate nohighlight">\(\mathrm{k}\lambda\)</span></p></td>
<td><p>11 <span class="math notranslate nohighlight">\(\mathrm{k}\lambda\)</span></p></td>
</tr>
<tr class="row-odd"><td><p>50 m</p></td>
<td><p>17 <span class="math notranslate nohighlight">\(\mathrm{k}\lambda\)</span></p></td>
<td><p>38 <span class="math notranslate nohighlight">\(\mathrm{k}\lambda\)</span></p></td>
<td><p>57 <span class="math notranslate nohighlight">\(\mathrm{k}\lambda\)</span></p></td>
</tr>
<tr class="row-even"><td><p>100 m</p></td>
<td><p>33 <span class="math notranslate nohighlight">\(\mathrm{k}\lambda\)</span></p></td>
<td><p>77 <span class="math notranslate nohighlight">\(\mathrm{k}\lambda\)</span></p></td>
<td><p>113 <span class="math notranslate nohighlight">\(\mathrm{k}\lambda\)</span></p></td>
</tr>
<tr class="row-odd"><td><p>500 m</p></td>
<td><p>167 <span class="math notranslate nohighlight">\(\mathrm{k}\lambda\)</span></p></td>
<td><p>384 <span class="math notranslate nohighlight">\(\mathrm{k}\lambda\)</span></p></td>
<td><p>567 <span class="math notranslate nohighlight">\(\mathrm{k}\lambda\)</span></p></td>
</tr>
<tr class="row-even"><td><p>1 km</p></td>
<td><p>334 <span class="math notranslate nohighlight">\(\mathrm{k}\lambda\)</span></p></td>
<td><p>767 <span class="math notranslate nohighlight">\(\mathrm{k}\lambda\)</span></p></td>
<td><p>1 <span class="math notranslate nohighlight">\(\mathrm{M}\lambda\)</span></p></td>
</tr>
<tr class="row-odd"><td><p>5 km</p></td>
<td><p>2 <span class="math notranslate nohighlight">\(\mathrm{M}\lambda\)</span></p></td>
<td><p>4 <span class="math notranslate nohighlight">\(\mathrm{M}\lambda\)</span></p></td>
<td><p>6 <span class="math notranslate nohighlight">\(\mathrm{M}\lambda\)</span></p></td>
</tr>
<tr class="row-even"><td><p>10 km</p></td>
<td><p>3 <span class="math notranslate nohighlight">\(\mathrm{M}\lambda\)</span></p></td>
<td><p>8 <span class="math notranslate nohighlight">\(\mathrm{M}\lambda\)</span></p></td>
<td><p>11 <span class="math notranslate nohighlight">\(\mathrm{M}\lambda\)</span></p></td>
</tr>
<tr class="row-odd"><td><p>16 km</p></td>
<td><p>5 <span class="math notranslate nohighlight">\(\mathrm{M}\lambda\)</span></p></td>
<td><p>12 <span class="math notranslate nohighlight">\(\mathrm{M}\lambda\)</span></p></td>
<td><p>18 <span class="math notranslate nohighlight">\(\mathrm{M}\lambda\)</span></p></td>
</tr>
</tbody>
</table>
<p>Occasionally, it is useful to represent the cartesian Fourier coordinates <span class="math notranslate nohighlight">\(u\)</span>, <span class="math notranslate nohighlight">\(v\)</span> in polar coordinates <span class="math notranslate nohighlight">\(q\)</span>, <span class="math notranslate nohighlight">\(\phi\)</span></p>
<div class="math notranslate nohighlight">
\[\begin{split}
q = \sqrt{u^2 + v^2}\\
\phi = \mathrm{atan2}(v,u).
\end{split}\]</div>
<p><span class="math notranslate nohighlight">\(\phi\)</span> represents the angle between the <span class="math notranslate nohighlight">\(+u\)</span> axis and the ray drawn from the origin to the point <span class="math notranslate nohighlight">\((u,v)\)</span>. Following the <a class="reference external" href="https://en.wikipedia.org/wiki/Atan2">numerical conventions</a> of the <code class="docutils literal notranslate"><span class="pre">arctan2</span></code> function, <span class="math notranslate nohighlight">\(\phi\)</span> is defined over the range <span class="math notranslate nohighlight">\((-\pi, \pi]\)</span>.</p>
</section>
<section id="the-discrete-fourier-transform">
<h3>The discrete Fourier transform<a class="headerlink" href="#the-discrete-fourier-transform" title="Permalink to this headline">#</a></h3>
<p>Since we are dealing with discrete quantities (pixels), we use the discrete versions of the Fourier transform (DFT), carried out by the Fast Fourier transform (FFT). Throughout the package we use the implementations in numpy or PyTorch: they are mathematically the same, but PyTorch provides the opportunities for autodifferentiation. For both the forward and inverse transforms, we assume that <code class="docutils literal notranslate"><span class="pre">norm='backward'</span></code>, the default setting. This means we don’t need to keep account for the <span class="math notranslate nohighlight">\(L\)</span> or <span class="math notranslate nohighlight">\(M\)</span> prefactors for the forward transform, but we do need to account for the <span class="math notranslate nohighlight">\(U\)</span> and <span class="math notranslate nohighlight">\(V\)</span> prefactors in the inverse transform.</p>
<p><strong>Forward transform</strong>: As before, we use the forward transform to go from the image plane (sky brightness distribution) to the Fourier plane (visibility function). This is the most common transform used in MPoL because RML can be thought of as a type of forward modeling procedure: we’re proposing an image and carrying it to the visibility plane to check its fit with the data. In numpy, the forward FFT is <a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/routines.fft.html#module-numpy.fft">defined as</a></p>
<div class="math notranslate nohighlight">
\[
\mathtt{FFT}(I_{l,m}) = \sum_{l=0}^{L-1} \sum_{m=0}^{M-1} I_{l,m} \exp \left \{- 2 \pi i (ul/L + vm/M) \right \}
\]</div>
<p>To make the FFT output an appropriate representation of the continuous forward Fourier transform, we need to account for the spacing of the input samples. The FFT knows only that it was served a sequence of numbers, it does not know that the samples in <span class="math notranslate nohighlight">\(I_{l,m}\)</span> are spaced <code class="docutils literal notranslate"><span class="pre">cell_size</span></code> apart. To do this, we just need to account for the spacing as a prefactor (i.e., converting the <span class="math notranslate nohighlight">\(\mathrm{d}l\)</span> to <span class="math notranslate nohighlight">\(\Delta l\)</span>), following <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2017isra.book.....T/abstract">TMS Eqn A8.18</a></p>
<div class="math notranslate nohighlight">
\[
V_{u,v} = (\Delta l)(\Delta m) \mathtt{FFT}(I_{l,m})
\]</div>
<p>In this context, the <span class="math notranslate nohighlight">\(u,v\)</span> subscripts indicate the elements of the <span class="math notranslate nohighlight">\(V\)</span> array. As long as <span class="math notranslate nohighlight">\(I_{l,m}\)</span> is in units of <span class="math notranslate nohighlight">\(\mathrm{Jy} / (\Delta l \Delta m)\)</span>, then <span class="math notranslate nohighlight">\(V\)</span> will be in the correct output units (flux, or Jy).</p>
<p><strong>Inverse transform</strong>: The inverse transform is used within MPoL to produce a quick diagnostic image from the visibilities (called the “dirty image”). As you might expect, this is the inverse operation of the forward transform. Numpy and PyTorch define the inverse transform as</p>
<div class="math notranslate nohighlight">
\[
\mathtt{iFFT}({\cal V}_{u,v}) = \frac{1}{U} \frac{1}{V} \sum_{l=0}^{U-1} \sum_{m=0}^{V-1} {\cal V}_{u,v} \exp \left \{2 \pi i (ul/L + vm/M) \right \}
\]</div>
<p>If we had a fully sampled grid of <span class="math notranslate nohighlight">\({\cal V}_{u,v}\)</span> values, then the operation we’d want to carry out to produce an image needs to correct for both the cell spacing and the counting terms</p>
<div class="math notranslate nohighlight">
\[
I_{l,m} = U V (\Delta u)(\Delta v) \mathtt{iFFT}({\cal V}_{u,v})
\]</div>
<p>For more information on this procedure as implmented in MPoL, see the <code class="xref py py-class docutils literal notranslate"><span class="pre">Gridder</span></code> class and the source code of its <code class="xref py py-func docutils literal notranslate"><span class="pre">get_dirty_image()</span></code> method. When the grid of <span class="math notranslate nohighlight">\({\cal V}_{u,v}\)</span> values is not fully sampled (as in any real-world interferometric observation), there are many subtleties beyond this simple equation that warrant consideration when synthesizing an image via inverse Fourier transform. For more information, consult the seminal <a class="reference external" href="http://www.aoc.nrao.edu/dissertations/dbriggs/">Ph.D. thesis</a> of Daniel Briggs.</p>
</section>
<section id="image-cube-packing-for-ffts">
<span id="cube-orientation-label"></span><h3>Image Cube Packing for FFTs<a class="headerlink" href="#image-cube-packing-for-ffts" title="Permalink to this headline">#</a></h3>
<p>Numerical FFT routines expect that the first element of an input array (i.e., <code class="docutils literal notranslate"><span class="pre">array[i,0,0]</span></code>) corresponds to the zeroth spatial (<span class="math notranslate nohighlight">\(l,m\)</span>) or frequency (<span class="math notranslate nohighlight">\(u,v\)</span>) coordinate. This convention is quite different than the way we normally look at images. As described above, MPoL deals with three dimensional image cubes of shape <code class="docutils literal notranslate"><span class="pre">(nchan,</span> <span class="pre">npix,</span> <span class="pre">npix)</span></code>, where the “rows” of the image cube (axis=1) correspond to the <span class="math notranslate nohighlight">\(m\)</span> or Dec axis, and the “columns” of the image cube (axis=2) correspond to the <span class="math notranslate nohighlight">\(l\)</span> or R.A. axis. Normally, the zeroth spatial component <span class="math notranslate nohighlight">\((l,m) = (0,0)\)</span> is in the <em>center</em> of the array (at position <code class="docutils literal notranslate"><span class="pre">array[i,M/2,L/2]</span></code>), so that when an array is visualized (say with <code class="docutils literal notranslate"><span class="pre">matplotlib.pyplot.imshow</span></code>, <code class="docutils literal notranslate"><span class="pre">origin=&quot;lower&quot;</span></code>), the center of the array appears in the center of the image.</p>
<img alt="_images/plot.png" src="_images/plot.png" />
<p>Complicating this already non-standard situation is the fact that astronomers usually plot images as seen on the sky: with north (<span class="math notranslate nohighlight">\(m\)</span>) up and east (<span class="math notranslate nohighlight">\(l\)</span>) to the left. Throughout the MPoL base, we call these cubes ‘sky cubes,’ see the above figure for a representation. In order to display sky cubes properly with routines like <code class="docutils literal notranslate"><span class="pre">matplotilb.pyplot.imshow</span></code>, when indexed as <code class="docutils literal notranslate"><span class="pre">array[i,j,k]</span></code>, an increasing <code class="docutils literal notranslate"><span class="pre">k</span></code> index must correspond to <em>decreasing</em> values of <span class="math notranslate nohighlight">\(l\)</span>. (It’s OK that an increasing <code class="docutils literal notranslate"><span class="pre">j</span></code> index corresponds to increasing values of <span class="math notranslate nohighlight">\(m\)</span>, however we must be certain to include the <code class="docutils literal notranslate"><span class="pre">origin=&quot;lower</span></code> argument when using <code class="docutils literal notranslate"><span class="pre">matplotlib.pyplot.imshow</span></code>).</p>
<p>Correctly taking the Fourier transform of a sky cube requires several steps.  First, we must flip the cube across the R.A. axis (axis=2) to create an <code class="docutils literal notranslate"><span class="pre">array[i,j,k]</span></code> which has both increasing values of <code class="docutils literal notranslate"><span class="pre">j</span></code> and <code class="docutils literal notranslate"><span class="pre">k</span></code> correspond to increasing values of <span class="math notranslate nohighlight">\(m\)</span> and <span class="math notranslate nohighlight">\(l\)</span>, respectively. We call this intermediate product a ‘flip cube.’</p>
<p>Then, the cube must be packed such that the first element(s) of an input array (i.e., <code class="docutils literal notranslate"><span class="pre">array[i,0,0]</span></code>) correspond to the zeroth spatial coordinates <span class="math notranslate nohighlight">\((l,m) = (0,0)\)</span>. Thankfully, we can carry out this operation easily using <code class="docutils literal notranslate"><span class="pre">fftshift</span></code> functions commonly provided by FFT packages like <code class="docutils literal notranslate"><span class="pre">numpy.fft</span></code> or <code class="docutils literal notranslate"><span class="pre">torch.fft</span></code>. We shift across the Dec and R.A. axes (axis=1 and axis=2) leaving the channel axis (axis=0) untouched to create a ‘packed image cube.’ MPoL has convenience functions to carry out both the flip and packing operations called <a class="reference internal" href="api.html#mpol.utils.sky_cube_to_packed_cube" title="mpol.utils.sky_cube_to_packed_cube"><code class="xref py py-func docutils literal notranslate"><span class="pre">mpol.utils.sky_cube_to_packed_cube()</span></code></a> and the inverse process <a class="reference internal" href="api.html#mpol.utils.packed_cube_to_sky_cube" title="mpol.utils.packed_cube_to_sky_cube"><code class="xref py py-func docutils literal notranslate"><span class="pre">mpol.utils.packed_cube_to_sky_cube()</span></code></a>.</p>
<p>After the FFT is correctly applied to the R.A. and Dec dimensions using <code class="docutils literal notranslate"><span class="pre">fft2</span></code>, the output is a packed visibility cube, where the first elements (i.e., <code class="docutils literal notranslate"><span class="pre">array[i,0,0]</span></code>) correspond to the zeroth spatial frequency coordinates <span class="math notranslate nohighlight">\((u,v) = (0,0)\)</span>. To translate this cube back into something that’s more recognizable when plotted, we can apply the <code class="docutils literal notranslate"><span class="pre">ifftshift</span></code> operation along the <span class="math notranslate nohighlight">\(v\)</span> and <span class="math notranslate nohighlight">\(u\)</span> axes (axis=1 and axis=2) leaving the channel axis (axis=0) untouched to create a ‘ground visibility cube’. We choose to orient the visibility plane from the perspective of an areial observer looking down at an interferometric array on the ground, such that north is up and east is to the right, therefore no additional flip is required for the visibility cube. MPoL has convenience functions to carry out the unpacking operation <a class="reference internal" href="api.html#mpol.utils.packed_cube_to_ground_cube" title="mpol.utils.packed_cube_to_ground_cube"><code class="xref py py-func docutils literal notranslate"><span class="pre">mpol.utils.packed_cube_to_ground_cube()</span></code></a> and the inverse process <a class="reference internal" href="api.html#mpol.utils.ground_cube_to_packed_cube" title="mpol.utils.ground_cube_to_packed_cube"><code class="xref py py-func docutils literal notranslate"><span class="pre">mpol.utils.ground_cube_to_packed_cube()</span></code></a>.</p>
<p>In practice, <code class="docutils literal notranslate"><span class="pre">fftshift</span></code> and <code class="docutils literal notranslate"><span class="pre">ifftshift</span></code> routines operate identically for arrays with an even number of elements (currently required by MPoL).</p>
</section>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="installation.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">MPoL Installation</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="developer-documentation.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Developer Documentation</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Ian Czekala<br/>
  
      &copy; Copyright 2019-22, Ian Czekala.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>