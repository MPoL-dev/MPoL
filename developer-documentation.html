

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Developer Documentation &#8212; MPoL 0.2.0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script src="https://buttons.github.io/buttons.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'developer-documentation';</script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="API" href="api.html" />
    <link rel="prev" title="Units and Conventions" href="units-and-conventions.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="MPoL 0.2.0 documentation - Home"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="MPoL 0.2.0 documentation - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="rml_intro.html">Introduction to Regularized Maximum Likelihood Imaging</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">MPoL Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="units-and-conventions.html">Units and Conventions</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Developer Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ci-tutorials/PyTorch.html">Introduction to PyTorch: Tensors and Gradient Descent</a></li>
<li class="toctree-l1"><a class="reference internal" href="ci-tutorials/gridder.html">Gridding and diagnostic images</a></li>
<li class="toctree-l1"><a class="reference internal" href="ci-tutorials/optimization.html">Intro to RML with MPoL</a></li>
<li class="toctree-l1"><a class="reference internal" href="ci-tutorials/loose-visibilities.html">Likelihood functions and model visibilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="ci-tutorials/crossvalidation.html">Cross validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="ci-tutorials/gpu_setup.html">GPU Acceleration</a></li>
<li class="toctree-l1"><a class="reference internal" href="ci-tutorials/initializedirtyimage.html">Initializing with the Dirty Image</a></li>
<li class="toctree-l1"><a class="reference internal" href="large-tutorials/HD143006_part_1.html">HD143006 Tutorial Part 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="large-tutorials/HD143006_part_2.html">HD143006 Tutorial Part 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="ci-tutorials/fakedata.html">Making a Mock Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="large-tutorials/pyro.html">Parametric Inference with Pyro</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/MPoL-dev/MPoL" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/developer-documentation.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Developer Documentation</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-model">Release model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-up-your-development-environment">Setting up your development environment</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#forking-mpol-and-cloning-from-github">Forking MPoL and cloning from Github</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#python-virtual-environment">Python virtual environment</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#installing-mpol-and-development-dependencies">Installing MPoL and development dependencies</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#testing">Testing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#installing-dependencies">Installing dependencies</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#running-the-tests">Running the tests</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#test-cache">Test cache</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#viewing-test-and-debug-plots">Viewing test and debug plots</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#test-coverage">Test coverage</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#documentation">Documentation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dependencies">Dependencies</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#building-the-documentation">Building the Documentation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#contributing">Contributing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#contributing-code-and-tests">Contributing code and tests</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#contributing-documentation">Contributing documentation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#contributing-tutorials">Contributing tutorials</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#small-ish-tutorials-requiring-only-a-cpu">Small(ish) tutorials requiring only a CPU</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#larger-tutorials-requiring-substantial-computational-resources">Larger tutorials requiring substantial computational resources</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#tutorial-best-practices">Tutorial best practices</a></li>
</ul>
</li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="developer-documentation">
<span id="developer-documentation-label"></span><h1>Developer Documentation<a class="headerlink" href="#developer-documentation" title="Permalink to this heading">#</a></h1>
<p>If you find an issue with the code, documentation, or would like to make a specific suggestion for an improvement, please raise an issue on the <a class="reference external" href="https://github.com/MPoL-dev/MPoL/issues">Github repository</a>. If you have a more general query or would just like to discuss a topic, please make a post on our <a class="reference external" href="https://github.com/MPoL-dev/MPoL/discussions">Github discussions page</a>.</p>
<p>If you are new to contributing to an open source project, we recommend a quick read through the excellent contributing guides of the <a class="reference external" href="https://docs.exoplanet.codes/en/stable/user/dev/">exoplanet</a> and <a class="reference external" href="https://docs.astropy.org/en/stable/development/workflow/development_workflow.html">astropy</a> packages. What follows in this guide draws upon many of the suggestions from those two resources. There are many ways to contribute to an open source project like MPoL, and all of them are valuable to us. No contribution is too small—even a typo fix is appreciated!</p>
<section id="release-model">
<h2>Release model<a class="headerlink" href="#release-model" title="Permalink to this heading">#</a></h2>
<p>The MPoL project values stable software, and so we place a special emphasis on writing and running tests to ensure the code works reliably for as many users as possible. It is our intent that the <code class="docutils literal notranslate"><span class="pre">main</span></code> branch of the github repository always reflects a stable version of the code that passes all tests. After significant new functionality has been introduced, a tagged release (e.g., <code class="docutils literal notranslate"><span class="pre">v0.1.1</span></code>) is generated from the main branch and pushed to PyPI.</p>
</section>
<section id="setting-up-your-development-environment">
<h2>Setting up your development environment<a class="headerlink" href="#setting-up-your-development-environment" title="Permalink to this heading">#</a></h2>
<section id="forking-mpol-and-cloning-from-github">
<h3>Forking MPoL and cloning from Github<a class="headerlink" href="#forking-mpol-and-cloning-from-github" title="Permalink to this heading">#</a></h3>
<p>MPoL is developed using the git version control system. The source repository is hosted on <a class="reference external" href="https://github.com/MPoL-dev/MPoL">Github</a> as part of the <a class="reference external" href="https://github.com/MPoL-dev/">MPoL-dev</a> organization. If you are new to using git and Github, we recommend reviewing the git resources on the <a class="reference external" href="https://docs.astropy.org/en/stable/development/workflow/development_workflow.html">astropy contributing guide</a>.</p>
<p>We use a “fork and pull request” model for collaborative development. If you are unfamiliar with this workflow, check out this short Github guide on <a class="reference external" href="https://guides.github.com/activities/forking/">forking projects</a>. For even more reference material, see the official Github documentation on <a class="reference external" href="https://docs.github.com/en/github/collaborating-with-issues-and-pull-requests">collaborating with issues and pull requests</a>.</p>
<p>After forking the MPoL repository to your own github account, clone the repository to your local machine.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git clone https://github.com/YOURUSERNAME/MPoL.git
</pre></div>
</div>
</section>
<section id="python-virtual-environment">
<h3>Python virtual environment<a class="headerlink" href="#python-virtual-environment" title="Permalink to this heading">#</a></h3>
<p>To keep things organized, we recommend creating a Python <a class="reference external" href="https://docs.python.org/3/tutorial/venv.html">virtual environment</a> specifically for MPoL development (though this step isn’t strictly necessary). To do this,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd MPoL
$ python3 -m venv venv
</pre></div>
</div>
<p>More information on virtual environments is available through the official <a class="reference external" href="https://docs.python.org/3/tutorial/venv.html">Python documentation</a>. Then, activate the virtual environment</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ source venv/bin/activate
</pre></div>
</div>
<p>This gives you a clean Python environment in which to work without fear of conflicting package dependencies (e.g., perhaps you want to have two versions of MPoL installed on your system, one for production work and the other for development work. This is possible as long as you use two different virtual environments). You will need to remember to activate the corresponding virtual environment with each new shell session, however.</p>
</section>
<section id="installing-mpol-and-development-dependencies">
<h3>Installing MPoL and development dependencies<a class="headerlink" href="#installing-mpol-and-development-dependencies" title="Permalink to this heading">#</a></h3>
<p>Then, use pip to install the MPoL package. We recommend installing the package using</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(venv) $ pip install -e &quot;.[dev]&quot;
</pre></div>
</div>
<p>This directs pip to install whatever package is in the current working directory (<code class="docutils literal notranslate"><span class="pre">.</span></code>) as an editable package (<code class="docutils literal notranslate"><span class="pre">-e</span></code>). More information on the pip command line arguments is available via <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">--help</span></code>. We’ve additionally told pip to install the packages listed in the (<code class="docutils literal notranslate"><span class="pre">[dev]</span></code>) <code class="docutils literal notranslate"><span class="pre">EXTRA_REQUIRES</span></code> variable in <a class="reference external" href="https://github.com/MPoL-dev/MPoL/blob/main/setup.py">setup.py</a>. This variable contains a list of all of the Python packages that you might need throughout the course of developing and testing the package (e.g., pytest). These packages are only needed when developing, building, and testing the package. They are not needed to run the package in its normal configuration, hence, they are not installed with the vanilla <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">MPoL</span></code>.</p>
<p>We also recommend using a set of git <a class="reference external" href="https://pre-commit.com/">pre-commit hooks</a> that we have configured via the <code class="docutils literal notranslate"><span class="pre">.pre-commit-config.yaml</span></code> file in the MPoL repository. They are very useful tools for keeping git diffs orderly and small. To install these tools to your local copy of the MPoL repository, run</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pre-commit install
</pre></div>
</div>
<p>Then, each time you run <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">commit</span></code> these scripts will run on the repository code and check for things like whether your code complies with formatting guidelines. If any issues are found, the pre-commit script will stop the commit and correct the offending files for you. Then, you can redo the <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">commit</span></code> with the modified files.</p>
</section>
</section>
<section id="testing">
<span id="testing-reference-label"></span><h2>Testing<a class="headerlink" href="#testing" title="Permalink to this heading">#</a></h2>
<p>MPoL includes a test suite written using <a class="reference external" href="https://docs.pytest.org/">pytest</a>. We aim for this test suite to be as comprehensive as possible, since this helps us achieve our goal of shipping stable software.</p>
<section id="installing-dependencies">
<h3>Installing dependencies<a class="headerlink" href="#installing-dependencies" title="Permalink to this heading">#</a></h3>
<p>If you are only interested in running the tests, you can install the more limited set of testing package dependencies via</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pip install &quot;.[test]&quot;
</pre></div>
</div>
<p>after you’ve cloned the repository and changed to the root of the repository. Otherwise, we recommend following the development environment instructions above, since the <code class="docutils literal notranslate"><span class="pre">[dev]</span></code> list is a superset of the <code class="docutils literal notranslate"><span class="pre">[test]</span></code> list.</p>
</section>
<section id="running-the-tests">
<h3>Running the tests<a class="headerlink" href="#running-the-tests" title="Permalink to this heading">#</a></h3>
<p>To run all of the tests, change to the root of the repository and invoke</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python -m pytest
</pre></div>
</div>
<p>If a test errors (especially on the <code class="docutils literal notranslate"><span class="pre">main</span></code> branch), please report what went wrong as a bug report issue on the <a class="reference external" href="https://github.com/MPoL-dev/MPoL/issues">Github repository</a>.</p>
</section>
<section id="test-cache">
<h3>Test cache<a class="headerlink" href="#test-cache" title="Permalink to this heading">#</a></h3>
<p>Several of the tests require mock data that is not practical to package within the github repository itself, and so it is stored on Zenodo and downloaded using astropy caching functions. If you run into trouble with the test cache becoming stale, you can delete it by deleting the <code class="docutils literal notranslate"><span class="pre">.mpol/cache</span></code> folder in your home directory.</p>
</section>
<section id="viewing-test-and-debug-plots">
<h3>Viewing test and debug plots<a class="headerlink" href="#viewing-test-and-debug-plots" title="Permalink to this heading">#</a></h3>
<p>Some tests produce temporary files, like plots, that could be useful to view for development or debugging. Normally these are saved to a temporary directory created by the system which will be cleaned up after the tests finish. To preserve them, first create a plot directory (e.g., <code class="docutils literal notranslate"><span class="pre">plotsdir</span></code>) and then run the tests with this <code class="docutils literal notranslate"><span class="pre">--basetemp</span></code> specified</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mkdir plotsdir
$ python -m pytest --basetemp=plotsdir
</pre></div>
</div>
</section>
<section id="test-coverage">
<h3>Test coverage<a class="headerlink" href="#test-coverage" title="Permalink to this heading">#</a></h3>
<p>To investigate how well the test suite covers the full range of program functionality, you can run <a class="reference external" href="https://coverage.readthedocs.io/en/coverage-5.5/">coverage.py</a> through pytest using <a class="reference external" href="https://pypi.org/project/pytest-cov/">pytest-cov</a>, which should already be installed as part of the <code class="docutils literal notranslate"><span class="pre">[test]</span></code> dependencies</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pytest --cov=mpol
$ coverage html
</pre></div>
</div>
<p>And then use your favorite web browser to open <code class="docutils literal notranslate"><span class="pre">htmlcov/index.html</span></code> and view the coverage report.</p>
<p>For more information on code coverage, see the <a class="reference external" href="https://coverage.readthedocs.io/en/coverage-5.5/">coverage.py documentation</a>. A worthy goal is to reach 100% code coverage with the testing suite. However, 100% coverage <em>doesn’t mean the code is free of bugs</em>. More important than complete coverage is writing tests that properly probe program functionality.</p>
</section>
</section>
<section id="documentation">
<h2>Documentation<a class="headerlink" href="#documentation" title="Permalink to this heading">#</a></h2>
<p>MPoL documentation is written as docstrings attached to MPoL classes and functions and as individual <code class="docutils literal notranslate"><span class="pre">.rst</span></code> or <code class="docutils literal notranslate"><span class="pre">.md</span></code> files located in the <code class="docutils literal notranslate"><span class="pre">docs/</span></code> folder. The documentation is built using the <a class="reference external" href="https://www.sphinx-doc.org/en/master/">Sphinx</a> Python documentation generator, with the <a class="reference external" href="https://myst-nb.readthedocs.io/en/latest/index.html">MyST-NB</a> plugin.</p>
<section id="dependencies">
<h3>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this heading">#</a></h3>
<p>If you are only interested in building the documentation, you can install the more limited set of documentation package dependencies via</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pip install &quot;.[docs]&quot;
</pre></div>
</div>
<p>after you’ve cloned the repository and changed to the root of the repository. Otherwise, we recommend following the development environment instructions above, since the <code class="docutils literal notranslate"><span class="pre">[dev]</span></code> list is a superset of the <code class="docutils literal notranslate"><span class="pre">[docs]</span></code> list.</p>
</section>
<section id="building-the-documentation">
<h3>Building the Documentation<a class="headerlink" href="#building-the-documentation" title="Permalink to this heading">#</a></h3>
<p>To build the documentation, change to the <code class="docutils literal notranslate"><span class="pre">docs/</span></code> folder and run</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ make html
</pre></div>
</div>
<p>If successful, the HTML documentation will be available in the <code class="docutils literal notranslate"><span class="pre">_build/html</span></code> folder. You can preview the documentation locally using your favorite web browser by opening up <code class="docutils literal notranslate"><span class="pre">_build/html/index.html</span></code></p>
<p>You can clean up (delete) all of the built products by running</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ make clean
</pre></div>
</div>
<p>For more information on the build process, take a look at the documentation makefile in <code class="docutils literal notranslate"><span class="pre">docs/Makefile</span></code>.</p>
</section>
</section>
<section id="contributing">
<h2>Contributing<a class="headerlink" href="#contributing" title="Permalink to this heading">#</a></h2>
<p>The following subsections describe recommended workflows for contributing code, documentation, and tutorials to the MPoL package. They are written assuming that you are familiar with the preceding development guidelines in this document.</p>
<p>In keeping with the <a class="reference external" href="https://guides.github.com/activities/forking/">fork and pull request model</a>, you carry out development on a forked version of the repository (i.e., <code class="docutils literal notranslate"><span class="pre">https://github.com/YOURUSERNAME/MPoL.git</span></code>) and, once you’re satisfied with your changes (and all code passes the tests), you initiate a pull request back to the central repository (<code class="docutils literal notranslate"><span class="pre">https://github.com/MPoL-dev/MPoL.git</span></code>).</p>
<p>In general, we envision the contribution lifecycle following a pattern:</p>
<ol class="arabic simple">
<li><p>If you notice that the MPoL-dev repository has newer changes since you made your fork, fetch upstream changes to your repository and merge them into the <code class="docutils literal notranslate"><span class="pre">main</span></code> branch. You can do this via the Github interface by clicking “fetch upstream” and then pulling the changes to your local machine with <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">pull</span></code>. Alternatively, you can do this from the command line by configuring the <a class="reference external" href="https://docs.github.com/en/github/collaborating-with-issues-and-pull-requests/configuring-a-remote-for-a-fork">remote upstream repository</a> to <code class="docutils literal notranslate"><span class="pre">https://github.com/MPoL-dev/MPoL.git</span></code> and <a class="reference external" href="https://docs.github.com/en/github/collaborating-with-issues-and-pull-requests/syncing-a-fork">syncing the changes</a> from the upstream repository to your forked repo.</p></li>
<li><p>Checkout the updated <code class="docutils literal notranslate"><span class="pre">main</span></code> branch of your MPoL repository and verify that it contains any new changes by comparing commits with <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">log</span></code>.</p></li>
<li><p>Run the test suite (with <code class="docutils literal notranslate"><span class="pre">pytest</span></code>) and verify that all tests pass. If not, raise a Github issue with the error.</p></li>
<li><p>Create a new feature branch with <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">checkout</span> <span class="pre">-b</span> <span class="pre">my_feature_branch</span></code>.</p></li>
<li><p>Develop your code/documentation/tutorial (see below) and commit your changes to the repository as you go. Be sure to commit the right things to the repository (such as source files) and avoid committing build products (like .png files produced as part of the documentation build, for example).</p></li>
<li><p>When you are satisfied with your changes, run the tests and build the documentation. If anything fails due to changes you made, please fix the code so that the tests pass and the documentation builds, then recommit your changes. If you cannot figure out why the tests or documentation are breaking, please raise a Github issue with the error.</p></li>
<li><p>Push the changes on your feature branch to Github with <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">push</span> <span class="pre">origin</span> <span class="pre">my_feature_branch</span></code>. Make sure that the automated tests and documentation build as part of Github actions complete successfully. If not, assess the error(s), make additional changes to your feature branch, and re-push the changes until all tests pass.</p></li>
<li><p>After the tests have completed successfully, use the Github interface to initiate a pull request back to the central repository. If you know that your feature branch isn’t ready to be merged, but would still like feedback on your work, please submit a <a class="reference external" href="https://github.blog/2019-02-14-introducing-draft-pull-requests/">draft or “work in progress”</a> pull request.</p></li>
<li><p>Someone will review your pull request and may suggest additional changes for improvements. If approved, your pull request will be merged into the MPoL-dev/MPoL repo. Thank you for your contribution!</p></li>
</ol>
<section id="contributing-code-and-tests">
<h3>Contributing code and tests<a class="headerlink" href="#contributing-code-and-tests" title="Permalink to this heading">#</a></h3>
<p>We strive to release a useable, stable software package. One way to help accomplish this is through writing rigorous and complete tests, especially after adding new functionality to the package. MPoL tests are located within the <code class="docutils literal notranslate"><span class="pre">test/</span></code> directory and follow <a class="reference external" href="https://docs.pytest.org/en/6.2.x/contents.html#toc">pytest</a> conventions. Please add your new tests to this directory—we love new and useful tests.</p>
<p>If you are adding new code functionality to the package, please make sure you have also written a set of corresponding tests probing the key interfaces. If you submit a pull request implementing code functionality without any new tests, be prepared for ‘tests’ to be one of the first suggestions on your pull request. Some helpful advice on <em>which</em> tests to write is <a class="reference external" href="https://docs.python-guide.org/writing/tests/">here</a>, <a class="reference external" href="https://realpython.com/pytest-python-testing/">here</a>, and <a class="reference external" href="https://www.nerdwallet.com/blog/engineering/5-pytest-best-practices/">here</a>.</p>
<p>For MPoL maintainers, see instructions <a class="reference external" href="https://github.com/MPoL-dev/MPoL/wiki/Releasing-a-new-version-of-MPoL">here</a> for releasing a new version of MPoL.</p>
</section>
<section id="contributing-documentation">
<h3>Contributing documentation<a class="headerlink" href="#contributing-documentation" title="Permalink to this heading">#</a></h3>
<p>A general workflow for writing documentation might look like</p>
<ol class="arabic simple">
<li><p>run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">html</span></code> in the <code class="docutils literal notranslate"><span class="pre">docs/</span></code> folder</p></li>
<li><p>look at the built documentation with your web browser</p></li>
<li><p>write/edit documentation source as docstrings, <code class="docutils literal notranslate"><span class="pre">*.rst</span></code>, or <code class="docutils literal notranslate"><span class="pre">*.md</span></code> files</p></li>
<li><p>run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">html</span></code> to rebuild those files you’ve changed</p></li>
<li><p>go to #2 and repeat as necessary</p></li>
</ol>
<p>The idea behind <a class="reference external" href="https://www.gnu.org/software/make/manual/make.html">GNU make</a> is that every invocation of <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">html</span></code> will only rebuild the files whose dependencies have changed, saving lots of time.</p>
</section>
<section id="contributing-tutorials">
<h3>Contributing tutorials<a class="headerlink" href="#contributing-tutorials" title="Permalink to this heading">#</a></h3>
<p>If your tutorial is self-contained in scope and has limited computational needs (will complete on a single CPU in under 30 seconds), we recommend you provide the source file as a <a class="reference external" href="https://myst-nb.readthedocs.io/en/latest/authoring/basics.html#text-based-notebooks">MyST-NB <code class="docutils literal notranslate"><span class="pre">.md</span></code> file</a> so that we can build and test it as part of the continuous integration github workflow. If your tutorial requires more significant computational resources (e.g., a GPU, multiple CPS, or more than 30 seconds runtime), we suggest executing the notebook on your local computing resources and committing the <code class="docutils literal notranslate"><span class="pre">.ipynb</span></code> (with output cells) directly to the repository. Both types of tutorial formats are described in more detail below.</p>
<section id="small-ish-tutorials-requiring-only-a-cpu">
<h4>Small(ish) tutorials requiring only a CPU<a class="headerlink" href="#small-ish-tutorials-requiring-only-a-cpu" title="Permalink to this heading">#</a></h4>
<p>Like with the <a class="reference external" href="https://docs.exoplanet.codes/en/stable/user/dev/">exoplanet</a> codebase, MPoL tutorials are written as <a class="reference external" href="https://myst-nb.readthedocs.io/en/latest/authoring/basics.html#text-based-notebooks">MyST-NB <code class="docutils literal notranslate"><span class="pre">.md</span></code> source files</a>. During the Sphinx build process, they are converted to Jupyter notebooks and executed using the MyST build process. For these smaller tutorials, the <code class="docutils literal notranslate"><span class="pre">.md</span></code> file you create is the only thing you need to commit to the github repo (don’t commit the <code class="docutils literal notranslate"><span class="pre">.ipynb</span></code> file to the git repository in this case). This practice keeps the git diffs small while making it easier to edit tutorials with an integrated development environment.</p>
<p>To write a tutorial, we suggest copying and rename one of the existing <code class="docutils literal notranslate"><span class="pre">.md</span></code> files in <code class="docutils literal notranslate"><span class="pre">docs/ci-tutorials/</span></code> to <code class="docutils literal notranslate"><span class="pre">docs/ci-tutorials/your-new-tutorial</span></code>, being sure to keep the header metadata. Then, you can write your tutorial using the <a class="reference external" href="https://myst-nb.readthedocs.io/en/latest/authoring/text-notebooks.html">MyST markdown syntax</a>.</p>
<p>When done, add a reference to your tutorial in the table of contents in <code class="docutils literal notranslate"><span class="pre">docs/index.rst</span></code>. E.g., if your contribution is the <code class="docutils literal notranslate"><span class="pre">ci-tutorials/gridder.md</span></code> file, add a <code class="docutils literal notranslate"><span class="pre">ci-tutorials/gridder.md</span></code> line. Then, you should be able to build the documentation as normal (i.e., <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">html</span></code>) and your tutorial will be included in the documentation. The MyST-NB plugin is doing the work behind the scenes.</p>
<p>If your tutorial requires any extra build dependencies, please add them to the <code class="docutils literal notranslate"><span class="pre">EXTRA_REQUIRES['docs']</span></code> list in <code class="docutils literal notranslate"><span class="pre">setup.py</span></code>.</p>
</section>
<section id="larger-tutorials-requiring-substantial-computational-resources">
<h4>Larger tutorials requiring substantial computational resources<a class="headerlink" href="#larger-tutorials-requiring-substantial-computational-resources" title="Permalink to this heading">#</a></h4>
<p>Radio interferometric datasets are frequently large, and sometimes realistic tutorials with real data require substantial computational resources beyond those provided in github workflows. Though more burdensome to package, these “end-to-end” tutorials are often the most useful for users.</p>
<p>Larger tutorials are not contributed in a continuously-integrated fashion, but instead are built and executed using local computational resources (these could be your laptop or a university research cluster). We still recommend that you write your tutorial as a <code class="docutils literal notranslate"><span class="pre">.md</span></code> file like the smaller tutorials, and update the <code class="docutils literal notranslate"><span class="pre">large-tutorials/Makefile</span></code> with your new filenames. The difference here is that you will build the <code class="docutils literal notranslate"><span class="pre">.ipynb</span></code> version of your tutorial locally using <a class="reference external" href="https://jupytext.readthedocs.io/en/latest/">Jupytext</a> (you could use <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">all</span></code> inside the <code class="docutils literal notranslate"><span class="pre">large-tutorials</span></code> directory, or just run <code class="docutils literal notranslate"><span class="pre">jupytext</span> <span class="pre">--to</span> <span class="pre">ipynb</span> <span class="pre">--execute</span> <span class="pre">my_tutorial.py</span></code>) you <em>will</em> want to commit the <code class="docutils literal notranslate"><span class="pre">.ipynb</span></code> file containing the cell output directly to the git repository.</p>
<p>The expectation is that these tutorials will only be rerun when the tutorial is updated, so the git diff issue is not as large a concern as it was with the continuously-integrated smaller tutorials. Like before, the MyST-NB plugin will see a Jupyter notebook and incorporate it during the build process. Because the larger tutorials are not continuously integrated, however, there is some concern that the codebase could diverge from that used to generate the tutorial, rendering the tutorial stale. We believe this risk is acceptable given the benefit that these larger tutorials provide and we intend to check the tutorials for staleness with at least every minor release.</p>
<p>To summarize, to write a large tutorial:</p>
<ol class="arabic simple">
<li><p>copy and rename one of the existing <code class="docutils literal notranslate"><span class="pre">.md</span></code> files in <code class="docutils literal notranslate"><span class="pre">docs/large-tutorials</span></code> folder</p></li>
<li><p>use <a class="reference external" href="https://jupytext.readthedocs.io/en/latest/">Jupytext</a> to convert the <code class="docutils literal notranslate"><span class="pre">.md</span></code> to an <code class="docutils literal notranslate"><span class="pre">.ipynb</span></code> file and execute it on your local resources. You may want to add a line to the <code class="docutils literal notranslate"><span class="pre">docs/large-tutorials/Makefile</span></code> for your tutorial</p></li>
<li><p>commit the <code class="docutils literal notranslate"><span class="pre">.ipynb</span></code> to the MPoL repository, if you haven’t already (i.e., you’ll be committing <em>both</em> the <code class="docutils literal notranslate"><span class="pre">.md</span></code> and <code class="docutils literal notranslate"><span class="pre">.ipynb</span></code> files in this case).</p></li>
<li><p>if you run your notebook is run on a cluster, please also commit your submission script (e.g., SLURM, torque, moab). You may also consider additionally pasting the contents of the build script as a text cell inside the <code class="docutils literal notranslate"><span class="pre">.ipynb</span></code> for reference.</p></li>
</ol>
<p>When done, add a reference to your tutorial in the documentation table of contents. E.g., if your contribution is the <code class="docutils literal notranslate"><span class="pre">large-tutorials/gpus.ipynb</span></code> file, add a <code class="docutils literal notranslate"><span class="pre">large-tutorials/gpus.ipynb</span></code> line to the table of contents.</p>
</section>
<section id="tutorial-best-practices">
<h4>Tutorial best practices<a class="headerlink" href="#tutorial-best-practices" title="Permalink to this heading">#</a></h4>
<p>Tutorials should be self-contained. If the tutorial requires a dataset, the dataset should be publicly available and downloaded at the beginning of the script. If the dataset requires significant preprocessing (e.g., some multi-configuration ALMA datasets), those preprocessing steps should be in the tutorial. If the steps are tedious, one solution is to upload a preprocessed dataset to Zenodo and have the tutorial download the data product from there (the preprocessing scripts/steps should still be documented in the Zenodo repo and/or as part of the <a class="reference external" href="https://github.com/MPoL-dev/mpoldatasets">mpoldatasets repository</a>). The guiding principle is that other developers should be able to successfully build the tutorial from start to finish without relying on any locally provided resources or datasets.</p>
<p>If you’re thinking about contributing a tutorial and would like guidance on form or scope, please raise an <a class="reference external" href="https://github.com/MPoL-dev/MPoL/issues">issue</a> or <a class="reference external" href="https://github.com/MPoL-dev/MPoL/discussions">discussion</a> on the github repository.</p>
</section>
</section>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="units-and-conventions.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Units and Conventions</p>
      </div>
    </a>
    <a class="right-next"
       href="api.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">API</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-model">Release model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-up-your-development-environment">Setting up your development environment</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#forking-mpol-and-cloning-from-github">Forking MPoL and cloning from Github</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#python-virtual-environment">Python virtual environment</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#installing-mpol-and-development-dependencies">Installing MPoL and development dependencies</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#testing">Testing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#installing-dependencies">Installing dependencies</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#running-the-tests">Running the tests</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#test-cache">Test cache</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#viewing-test-and-debug-plots">Viewing test and debug plots</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#test-coverage">Test coverage</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#documentation">Documentation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dependencies">Dependencies</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#building-the-documentation">Building the Documentation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#contributing">Contributing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#contributing-code-and-tests">Contributing code and tests</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#contributing-documentation">Contributing documentation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#contributing-tutorials">Contributing tutorials</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#small-ish-tutorials-requiring-only-a-cpu">Small(ish) tutorials requiring only a CPU</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#larger-tutorials-requiring-substantial-computational-resources">Larger tutorials requiring substantial computational resources</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#tutorial-best-practices">Tutorial best practices</a></li>
</ul>
</li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Ian Czekala
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2019-22, Ian Czekala.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>